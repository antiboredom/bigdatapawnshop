"use strict";function setDaysRemaining(){var today=new Date,endday=new Date("December 31, 2014 11:59:00"),days=new Date(endday-today),num=days.getDate();$("#cyberdecember-days").html(num)}function loadProducts(){$.getJSON("data/products.json",function(data){data.categories.forEach(function(cat){cat.filenames.forEach(function(filename){var parsed={};if("spy"==cat.name){var name=categories[cat.name].parser({},filename),w=name.split(" ");w=w[0]+" "+w[1]+" "+w[w.length-1],parsed[w]=filename,categories[cat.name].images.push(parsed)}else parsed[categories[cat.name].parser({},filename)]=filename,categories[cat.name].images.push(parsed)}),categories[cat.name].items=cat.products}),nav(),route(currentCategory)})}function route(path){container.html(""),$(window).unbind("scroll");var params=path.split("/");currentCategory=params[0].replace("#",""),currentSubcategory=params[1]||null,populate(48)}function getRandomInt(min,max){return Math.floor(Math.random()*(max-min))+min}function populate(total){if(null==currentSubcategory){for(var i=0;total>i;i++){var item=categories[currentCategory].items[Math.floor(Math.random()*categories[currentCategory].items.length)],image=categories[currentCategory].images[Math.floor(Math.random()*categories[currentCategory].images.length)],product=getProduct(item,image),html=template(product);container.append(html)}$(window).bind("scroll",bindScroll)}else for(var itemIndices=Object.keys(categories[currentCategory].items),i=0;total>i;i++){var itemIndex=getRandomInt(0,itemIndices.length-1),image=$.grep(categories[currentCategory].images,function(e){return Object.keys(e)[0]==currentSubcategory});if(image.length<1)console.log("no keys for : "+currentSubcategory);else{image[0][currentSubcategory]&&(image=image[0][currentSubcategory]);var item=categories[currentCategory].items[itemIndex],product=getProduct(item,image),html=template(product);container.append(html)}}}function getProduct(item,image){var key;if("object"==typeof image)for(key in image)image.hasOwnProperty(key)&&(image=image[key]);var category=categories[currentCategory],zazzleURL="http://www.zazzle.com/api/create/at-238269211029758341??rf=238269211029758341&ax=Linkover&fwd=ProductPage&ed=true&tc=&ic=&t_image0_iid="+category.zazzleImageURL+image+"&t_image1_iid="+category.zazzleImageURL+image+"&pd="+item.pd,itemImage="238269211029758341___"+category.baseURL+image+"___"+item.pd+".jpg",bucketImgURL=category.productURL+itemImage,name=category.parser(item,image);return{zazzleURL:zazzleURL,imageURL:bucketImgURL,price:item.price,name:name,description:item.name,pd:item.pd}}function nav(){$("ul.products").html("");for(var catName in categories)if(categories.hasOwnProperty(catName)){var cat=categories[catName],items=[];cat.images.forEach(function(img){var name=Object.keys(img)[0];name=name.replace("_"," "),items.push({url:catName+"/"+name,name:name})});var html=navTemplate({items:items});$("."+catName+"-products").html(html)}$(".catalog-title a, ul.products a").on("click",function(){$(".welcome").is(":visible")&&($(".welcome").hide(),$("#dataset-title").show()),$("#dataset-title").html($(this).html()),route($(this).attr("href"))})}function bindScroll(){$(window).scrollTop()+$(window).height()>$(document).height()-100&&($(window).unbind("scroll"),populate(16))}function removeMe(el){$(el).parent().remove()}var categories={ant:{items:[],images:[],productURL:"http://bigdatapawnshop.s3.amazonaws.com/antProducts/",baseURL:"http%253A%252F%252Fbigdatapawnshop.s3.amazonaws.com%252Fant2%252F",zazzleImageURL:"http%3A%2F%2Fbigdatapawnshop.s3.amazonaws.com%2Fant2%2F",parser:function(item,image){return image.replace(".jpg","").replace("_"," ").replace("-"," ").toUpperCase().replace("ANT-","").replace("NSA","").replace("NSA ANT-","").trim()}},spy:{items:[],images:[],productURL:"http://bigdatapawnshop.s3.amazonaws.com/spyProducts/",baseURL:"http%253A%252F%252Fbigdatapawnshop.s3.amazonaws.com%252Fspy_files%252F",zazzleImageURL:"http%3A%2F%2Fbigdatapawnshop.s3.amazonaws.com%2Fspy_resized%2F",parser:function(item,image){var pattern,pattern2,pattern3,pattern4;if(image.indexOf("_docs_")>-1){var pattern=/spy3_https__www\.wikileaks\.org_spyfiles_docs_/,pattern2=/\.pdf_jpg\d{1,3}\.jpg/,pattern3=/\d{13}/,pattern4=/-[a-z][a-z]/,id=image.match(pattern2)[0];return id=id.replace(".pdf_jpg","").replace(".jpg","").trim(),image=image.replace(pattern," "),image=image.replace(pattern2," "),image=image.replace(pattern3," "),image=image.replace(pattern4," ").trim(),image=image.replace(/_/g," "),image=image.replace(/-/g," "),image.replace(".jpg","")+"  "+id}var pattern=/spy\d{1}_https__www\.wikileaks\.org_spyfiles_files_0_\d{1,3}/,pattern2=/-[a-z][a-z]/,pattern3=/\.pdf_jpg\d{1,3}\.jpg/,pattern4=/\d{6}/;if(image.length<10)return" ";var id=image.match(pattern3)[0];if(id=id?id.replace(".pdf_jpg","").replace(".jpg","").trim():id.replace(".pdf_jpg","").replace(".jpg","").trim()||" ",image=image.replace(pattern,""),image.indexOf("ELAMAN-200805-CATALOGUE-P1_")>-1){var p=/C_\d{1}_/i;image=image.replace("ELAMAN-200805-CATALOGUE-P1_elamancat_","ELAMAN MAY 2008 "),image=image.replace(p,""),image=image.replace("(2)"," ")}else image.indexOf("GAMMA-201110")>-1?image=image.replace("GAMMA-201110","GAMMA OCT 2011"):image.indexOf("BLUECOAT-8100_InstallGuide")>-1?image=image.replace("BLUECOAT-8100_InstallGuide","BLUECOAT INSTALL GUIDE"):image.indexOf("BEA-Catalogue-200806")>-1?image=image.replace("BEA-Catalogue-200806","BEA CATALOGUE JUN 2008"):image.indexOf("200810-ISS-PRG-GROUP2000-2")>-1?image=image.replace("200810-ISS-PRG-GROUP2000-2","ISS GROUP2000 OCT 2008"):image.indexOf("200906-ISS-PRG-GROUP2000")>-1?image=image.replace("200906-ISS-PRG-GROUP2000","ISS GROUP2000 JUN 2009"):image.indexOf("200810-ISS-PRG-SEPTIER")>-1?image=image.replace("200810-ISS-PRG-SEPTIER","ISS SEPTIER OCT 2008"):image.indexOf("200906-ISS-PRG-COBHAM")>-1?image=image.replace("200906-ISS-PRG-COBHAM","ISS COBHAM JUN 2006"):image.indexOf("200906-ISS-PRG-DIGITASK")>-1?image=image.replace("200906-ISS-PRG-DIGITASK","ISS DIGITASK JUN 2009"):image.indexOf("200906-ISS-PRG-SEPTIER")>-1?image=image.replace("200906-ISS-PRG-SEPTIER","ISS SEPTIER JUN 2009"):image.indexOf("200810-ISS-PRG-THALES")>-1?image=image.replace("200810-ISS-PRG-THALES","ISS THALES OCT 2008"):image.indexOf("201110-ISS-IAD-T1-GLIMMERGLASS")>-1?image=image.replace("201110-ISS-IAD-T1-GLIMMERGLASS","ISS IAD-T1 GLIMMERGLASS OCT 2011"):image.indexOf("201110-ISS-IAD-T4-NETRONOME")>-1?image=image.replace("201110-ISS-IAD-T4-NETRONOME","ISS IAD-T4 NETRONOME OCT 2011"):image.indexOf("201110-ISS-IAD-T4-SIMENA")>-1?image=image.replace("201110-ISS-IAD-T4-SIMENA","ISS IAD-T4 SIMENA OCT 2011"):image.indexOf(!1)&&(image.indexOf("200606")>-1?image=image.replace("EBS_Electronic-200606","EBS ELECTRONICS JUN 2006"):image.indexOf("200612")>-1?image=image.replace("EBS_Electronic-200612","EBS ELECTRONICS DEC 2006"):image.indexOf("200712")>-1?image=image.replace("EBS_Electronic-200712","EBS ELECTRONICS DEC 2007"):image.indexOf("200806")>-1&&(image=image.replace("EBS_Electronic-200806","EBS ELECTRONICS JUN 2008")));return image=image.replace(pattern2,""),image=image.replace(pattern3,""),image=image.replace(/_/g," "),image=image.replace(/-/g," "),image=image.toUpperCase(),image.trim().replace(".jpg","").trim()+" "+id}}},currentCategory="ant",currentSubcategory=null,container=$(".product-grid"),templateSource=$("#product-template").html(),template=Handlebars.compile(templateSource),navTemplateSource=$("#nav-item-template").html(),navTemplate=Handlebars.compile(navTemplateSource);setDaysRemaining(),loadProducts();var app=function(document,$){var docElem=document.documentElement,_userAgentInit=function(){docElem.setAttribute("data-useragent",navigator.userAgent)},_init=function(){$(document).foundation(),_userAgentInit()};return{init:_init}}(document,jQuery);!function(){app.init()}();